<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.53" />
  <meta name="author" content="Huang Jirong">
  <meta name="description" content="Data Scientist and Quantitative Investor and Trader">

  
  <link rel="alternate" hreflang="en-us" href="/project/hidden_markov_model/">

  
  


  

  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-116737154-1', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jirong&#39;s sandbox">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Jirong&#39;s sandbox">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/project/hidden_markov_model/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Jirong&#39;s sandbox">
  <meta property="og:url" content="/project/hidden_markov_model/">
  <meta property="og:title" content="Regime detection through hidden markov model | Jirong&#39;s sandbox">
  <meta property="og:description" content="">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-03-15T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2020-03-15T00:00:00&#43;00:00">
  

  

  <title>Regime detection through hidden markov model | Jirong&#39;s sandbox</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" class="dark">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Jirong&#39;s sandbox</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/skin/skin-in-the-game">
            
            <span>Skin in the game</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/portfolio/portfolio">
            
            <span>Portfolio Performance</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/goals/goals">
            
            <span>Personal goals</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/subscribe/subscribe">
            
            <span>Subscribe Here</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article article-project" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">

    <div class="pub-title">
      <h1 itemprop="name">Regime detection through hidden markov model</h1>
      <span class="pub-authors" itemprop="author">&nbsp;</span>
      <span class="pull-right">
        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Regime%20detection%20through%20hidden%20markov%20model&amp;url=%2fproject%2fhidden_markov_model%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fproject%2fhidden_markov_model%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fproject%2fhidden_markov_model%2f&amp;title=Regime%20detection%20through%20hidden%20markov%20model"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fproject%2fhidden_markov_model%2f&amp;title=Regime%20detection%20through%20hidden%20markov%20model"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Regime%20detection%20through%20hidden%20markov%20model&amp;body=%2fproject%2fhidden_markov_model%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </span>
    </div>

    

    <div class="article-style" itemprop="articleBody">
      


<div id="regime-detection-through-hidden-markov-model" class="section level2">
<h2>Regime detection through hidden markov model</h2>
<p>It’s rumoured that in the early days of Renaissance Technologies - according to the book ‘The Man Who Solved the Market’ - hidden markov models are used for regime detection.</p>
<p>Here I am, a couple of decades later - employing this strategy. This will be integrated into my ‘Jarvis’ - a series of Algorithmic toolkits that advises me in all situations.</p>
<p>Hidden markov mode is a statistical unsupervised learning model used to model states. It’s often used in speech, bioinformatics, computational finance, etc. See wiki post (<a href="https://en.wikipedia.org/wiki/Hidden_Markov_model#Applications" class="uri">https://en.wikipedia.org/wiki/Hidden_Markov_model#Applications</a>) for more info.</p>
<p>And you would have guessed it; I’m using it for quant strategies.</p>
</div>
<div id="output-updated-daily" class="section level2">
<h2>Output updated daily</h2>
<p>In particular, I’m only highlighting the crisis state (stated in title of graph below) as I seek to hedge against downside risk during crisis/ low-negative growth - low inflation scenarios.</p>
<p><img src="/project/img/hmm.png" alt="/project/img/hmm.png"></p>
<p>Note: I wouldn’t want to claim credit over the code. I adapted mostly from this post (<a href="https://towardsdatascience.com/when-to-buy-the-dip-e2e128d737a7" class="uri">https://towardsdatascience.com/when-to-buy-the-dip-e2e128d737a7</a>). Changes made are mostly connection to APIs and output files.</p>
</div>
<div id="code" class="section level2">
<h2>Code</h2>
<pre><code>#import packages for use later in the HMM code

import pandas as pd
import sklearn.mixture as mix

import numpy as np
import scipy.stats as scs

import datetime as dt

import matplotlib as mpl
from matplotlib import cm
import matplotlib.pyplot as plt
from matplotlib.dates import YearLocator, MonthLocator

import seaborn as sns

from iex import Stock
import yfinance as yf

data = yf.Ticker(&quot;SPY&quot;)
data.info 
all_historic_data = data.history(period=&quot;max&quot;)

ticker_data_clean = all_historic_data[[&quot;Close&quot;, &quot;High&quot;, &quot;Low&quot;]]
ticker_data_clean[&quot;date&quot;] = ticker_data_clean.index 
ticker_data_clean[&quot;date&quot;] = pd.to_datetime(ticker_data_clean[&quot;date&quot;])
ticker_data_clean[&quot;range&quot;] = (ticker_data_clean[&quot;High&quot;]/ticker_data_clean[&quot;Low&quot;])-1
ticker_data_clean[&quot;return&quot;] = ticker_data_clean[&quot;Close&quot;].pct_change()
ticker_data_clean[&quot;close&quot;] = ticker_data_clean[&quot;Close&quot;]
del ticker_data_clean[&quot;High&quot;]
del ticker_data_clean[&quot;Low&quot;]
del ticker_data_clean[&quot;Close&quot;]


ticker_data_clean = ticker_data_clean[[&quot;date&quot;, &quot;return&quot;, &quot;range&quot;, &quot;close&quot;]]
ticker_data_clean.dropna(how=&quot;any&quot;, inplace=True)

#create train and test sets
#this methodology will randomly select 80% of our data

#msk = np.random.rand(len(ticker_data_clean)) &lt; 0.8
#train = ticker_data_clean[msk]
#test = ticker_data_clean[~msk]

#X_train = train[[&quot;date&quot;, &quot;return&quot;, &quot;range&quot;, &quot;close&quot;]].set_index(&quot;date&quot;)
#X_test = test[[&quot;date&quot;, &quot;return&quot;, &quot;range&quot;, &quot;close&quot;]].set_index(&quot;date&quot;)

X_train = ticker_data_clean[[&quot;date&quot;, &quot;return&quot;, &quot;range&quot;, &quot;close&quot;]].set_index(&quot;date&quot;)
X_test = ticker_data_clean[[&quot;date&quot;, &quot;return&quot;, &quot;range&quot;, &quot;close&quot;]].set_index(&quot;date&quot;)


model = mix.GaussianMixture(n_components=3, 
                            covariance_type=&quot;full&quot;, 
                            n_init=100, 
                            random_state=7).fit(X_train)

# Predict the optimal sequence of internal hidden state
hidden_states = model.predict(X_test)

print(&quot;Means and vars of each hidden state&quot;)
for i in range(model.n_components):
    print(&quot;{0}th hidden state&quot;.format(i))
    print(&quot;mean = &quot;, model.means_[i])
    print(&quot;var = &quot;, np.diag(model.covariances_[i]))
    print()
    
    
sns.set(font_scale=1.25)
style_kwds = {&#39;xtick.major.size&#39;: 3, &#39;ytick.major.size&#39;: 3,
              &#39;font.family&#39;:u&#39;courier prime code&#39;, &#39;legend.frameon&#39;: True}
sns.set_style(&#39;white&#39;, style_kwds)

fig, axs = plt.subplots(model.n_components, sharex=True, sharey=True, figsize=(12,9))
colors = cm.rainbow(np.linspace(0, 1, model.n_components))

for i, (ax, color) in enumerate(zip(axs, colors)):
    # Use fancy indexing to plot data in each state.
    mask = hidden_states == i
    ax.plot_date(X_test.index.values[mask],
                 X_test[&quot;close&quot;].values[mask],
                 &quot;.-&quot;, c=color)
    ax.set_title(&quot;{0}th hidden state&quot;.format(i), fontsize=16, fontweight=&#39;demi&#39;)

    # Format the ticks.
    ax.xaxis.set_major_locator(YearLocator())
    ax.xaxis.set_minor_locator(MonthLocator())
    sns.despine(offset=10)

plt.tight_layout()


sns.set(font_scale=1.5)
states = (pd.DataFrame(hidden_states, columns=[&#39;states&#39;], index=X_test.index)
          .join(X_test, how=&#39;inner&#39;)
          .reset_index(drop=False)
          .rename(columns={&#39;index&#39;:&#39;Date&#39;}))
states.head()

#Identify state in 2020-03-12--&gt;Crisis state--&gt;Embed in title
row_index = states[states[&#39;date&#39;] == &#39;2020-03-12&#39;].index.tolist()
crisis_state = states.iloc[row_index][&#39;states&#39;].tolist()[0]


#suppressing warnings because of some issues with the font package
#in general, would not rec turning off warnings.
import warnings
warnings.filterwarnings(&quot;ignore&quot;)

sns.set_style(&#39;white&#39;, style_kwds)
order = [0, 1, 2]
fg = sns.FacetGrid(data=states, hue=&#39;states&#39;, hue_order=order,
                   palette=colors, aspect=1.31, height=12)
fg.map(plt.scatter, &#39;date&#39;, &quot;close&quot;, alpha=0.8).add_legend()
sns.despine(offset=10)
fg.fig.suptitle(&#39;Historical SPY Regimes&#39; + &#39;, Crisis State is &#39; + str(crisis_state), fontsize=24, fontweight=&#39;demi&#39;)

plt.savefig(&#39;&#39;)</code></pre>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/investment">investment</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/finance">finance</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/programming">programming</a>
  
</div>




    
    
    

    
      
      
      
      

      
      
      
      
    

  </div>
</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="/project/xirr_cpf/"><span
      aria-hidden="true">&larr;</span> What&#39;re the returns (XIRR) for my CPFIS Portfolio</a></li>
    

    
  </ul>
</nav>

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//jirong.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

